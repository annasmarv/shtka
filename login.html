<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Login</title>
    <meta name="theme-color" content="#2f6f3b" />
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              brand: {
                primary: '#F59E0B',
                blue: '#1E3A8A',
                red: '#DC2626',
                ink: '#0B0F19'
              }
            },
            boxShadow: {
              soft: '0 12px 32px -12px rgba(11,15,25,.25)'
            },
            borderRadius: {
              max: '2rem'
            }
          }
        }
      }
    </script>
    <style>
      .grain{position:relative}
      .grain:before{content:"";position:absolute;inset:0;background-image:url('data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\' viewBox=\'0 0 200 200\' opacity=\'.05\'><filter id=\'n\'><feTurbulence type=\'fractalNoise\' baseFrequency=\'.8\' numOctaves=\'2\'/></filter><rect width=\'100%\' height=\'100%\' filter=\'url(%23n)\'/></svg>');mix-blend-mode:multiply;pointer-events:none}
    </style>
  </head>
  <body class="bg-[#FFFBEB] text-brand-ink min-h-dvh">
    <main id="main" class="flex items-center justify-center min-h-screen mx-auto max-w-7xl px-4 sm:px-6 lg:px-8 py-8 lg:py-16">
      <div class="grid lg:grid-cols-12 gap-8 items-center">
        <!-- Left brand panel -->
        <div class="lg:col-span-6 order-1 lg:order-1">
          <div class="relative rounded-[2rem] border border-black/10 bg-white p-8 sm:p-10 shadow-soft overflow-hidden grain">
            <div class="absolute -top-24 -right-16 h-72 w-72 rounded-full bg-brand-primary/60 blur-3xl"></div>
            <div class="absolute -bottom-24 -left-16 h-72 w-72 rounded-full bg-brand-primary/30 blur-3xl"></div>
            <div class="relative">
              <h1 class="text-3xl sm:text-4xl font-black leading-tight">
                Selamat datang,
              </h1>
              <p class="mt-3 text-black/70 max-w-prose">
                Masuk dengan NIS dan tanggal lahir Anda untuk masuk ke aplikasi.
              </p>
              <ul class="mt-6 space-y-2 text-sm">
                <li class="flex items-center gap-2">
                  <span class="inline-block h-2.5 w-2.5 rounded-full bg-brand-primary"></span>
                  Login dengan NIS dan Tanggal Lahir
                </li>
                <li class="flex items-center gap-2">
                  <span class="inline-block h-2.5 w-2.5 rounded-full bg-brand-blue"></span>
                  Aman dan terpercaya
                </li>
              </ul>
            </div>
          </div>
        </div>

        <!-- Right login card -->
        <div class="lg:col-span-6 order-2 lg:order-2">
          <section class="rounded-[2rem] border border-black/10 bg-white p-6 sm:p-8 shadow-soft">
            <div class="text-center">
              <img src="logo.png" alt="Logo" class="mx-auto h-14 w-14 rounded-full shadow" width="56" height="56" />
              <h2 class="mt-3 text-2xl font-black">Login</h2>
              <p class="mt-1 text-sm text-black/70">Masukkan NIS dan tanggal lahir Anda</p>
            </div>

            <!-- Alert Messages -->
            <div id="alertContainer" class="mt-4"></div>

            <form id="loginForm" class="mt-6 grid gap-4">
              <div>
                <label for="login" class="text-sm font-semibold block mb-2">
                  NIS (Username)
                </label>
                <input 
                  id="login" 
                  name="login" 
                  type="text" 
                  placeholder="Contoh: 20576" 
                  class="w-full rounded-xl border border-black/10 px-4 py-3 outline-none focus:ring-2 focus:ring-brand-primary"
                  required 
                />
              </div>

              <div>
                <label for="password" class="text-sm font-semibold block mb-2">
                  Tanggal Lahir
                </label>
                <div class="relative">
                  <input 
                    id="password" 
                    name="password" 
                    type="date" 
                    class="w-full rounded-xl border border-black/10 px-4 py-3 outline-none focus:ring-2 focus:ring-brand-primary"
                    required 
                  />
                </div>
                <p class="text-xs text-black/50 mt-2">Format: YYYY-MM-DD (Contoh: 2006-11-30)</p>
              </div>

              <div class="flex items-center">
                <label class="flex items-center gap-2">
                  <input type="checkbox" id="remember" name="remember" class="rounded border-black/10 focus:ring-brand-primary" />
                  <span class="text-sm">Ingat saya</span>
                </label>
              </div>

              <button type="submit" class="w-full rounded-full bg-brand-primary px-6 py-3 font-bold text-white shadow hover:bg-brand-primary/90 focus:outline-none focus:ring-4 focus:ring-brand-primary/50 transition">
                Masuk
              </button>
            </form>

            <div class="mt-6 text-center text-sm">
              <p class="text-black/60">
                Lupa informasi akun? Hubungi pihak sekolah kami.
              </p>
            </div>
          </section>
        </div>
      </div>
    </main>

    <script src="./auth.js"></script>
    <script>
      // Check if already logged in, redirect to dashboard
      (async function() {
        await requireLogout();
      })();

      document.getElementById('loginForm').addEventListener('submit', async function(e) {
        e.preventDefault();

        const nisInput = document.getElementById('login').value.trim();
        const birthDateInput = document.getElementById('password').value;
        
        // Convert date format YYYY-MM-DD to DDMMYYYY
        if (!birthDateInput) {
          showAlert('Tanggal lahir harus diisi', 'error');
          return;
        }

        const [year, month, day] = birthDateInput.split('-');
        const password = `${day}${month}${year}`;

        // Disable submit button
        const submitBtn = this.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = 'Sedang memproses...';

        const result = await auth.login(nisInput, password);

        if (result.success) {
          showAlert('Login berhasil! Mengalihkan...', 'success');
          setTimeout(() => {
            window.location.href = './dashboard.html';
          }, 1500);
        } else {
          showAlert(result.message, 'error');
          submitBtn.disabled = false;
          submitBtn.textContent = 'Masuk';
        }
      });

      function showAlert(message, type = 'info') {
        const alertContainer = document.getElementById('alertContainer');
        const bgColor = type === 'error' ? 'bg-red-50' : type === 'success' ? 'bg-green-50' : 'bg-blue-50';
        const borderColor = type === 'error' ? 'border-red-200' : type === 'success' ? 'border-green-200' : 'border-blue-200';
        const textColor = type === 'error' ? 'text-red-800' : type === 'success' ? 'text-green-800' : 'text-blue-800';

        alertContainer.innerHTML = `
          <div class="rounded-xl border ${borderColor} ${bgColor} p-4">
            <p class="text-sm ${textColor}">${message}</p>
          </div>
        `;

        // Auto remove after 5 seconds
        setTimeout(() => {
          alertContainer.innerHTML = '';
        }, 5000);
      }
    </script>
  </body>
</html>
